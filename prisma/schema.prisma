// 1. The Setup (This was missing!)
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_PRISMA_URL") // Matches the variable in your .env
  directUrl = env("POSTGRES_URL_NON_POOLING") // Matches the variable in your .env
}

// 2. The Models (With BigInt fixes)
model Repository {
  id           Int           @id @default(autoincrement())
  githubId     Int           @unique
  name         String
  url          String // ðŸ‘ˆ Added this (Fixes "url does not exist")
  pullRequests PullRequest[] // ðŸ‘ˆ Added this (Fixes "missing opposite relation")
}

model PullRequest {
  id         Int        @id @default(autoincrement())
  githubId   Int        @unique
  number     Int
  title      String
  status     String
  repoId     Int
  repository Repository @relation(fields: [repoId], references: [id])
  author     String
  score      Int?
  summary    String?
  comments   Comment[]
  updatedAt  DateTime   @updatedAt
}

model Comment {
  id          Int         @id @default(autoincrement())
  githubId    BigInt      @unique
  body        String // The actual text of the comment
  author      String // e.g., "coderabbitai"
  prId        Int
  pullRequest PullRequest @relation(fields: [prId], references: [id])
  createdAt   DateTime    @default(now())
}
